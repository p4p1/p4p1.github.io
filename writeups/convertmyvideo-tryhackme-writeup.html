<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Leo Smith's website, specialized in cyber security research, programming and audit. This website also contains my personal cyber security write ups and tools.">
  <meta name="author" content="Leo Smith">

  <title>Leo Smith - ConvertMyVideo</title>

  <!-- Bootstrap core CSS -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this theme -->
  <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- Theme CSS -->
  <link href="../css/freelancer.css" rel="stylesheet">
  <link href="../css/blog-post.css" rel="stylesheet">
  <link rel="shortcut icon" type="image/png" href="../img/favicon.png"/>
  <!-- Custom styles for this template -->

</head>

<body id="page-top">


  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">Leo Smith</a>
      <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../index.html">Home</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../writeups/">Write-Ups</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="../projects/">Projects</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container post">

    <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8">

        <!-- Title -->
        <h1 class="mt-4">ConvertMyVideo</h1>

        <!-- Author -->
        <p class="lead">
          by Leo Smith /
          <a href="https://github.com/p4p1">p4p1</a>
        </p>

        <hr>

        <!-- Date/Time -->
        <p>Created on Mon. 04 May 2020</p>

        <hr>

        <!-- Preview Image -->
        <img class="img-fluid rounded" src="https://tryhackme-images.s3.amazonaws.com/room-icons/cbe93621ee926a7dd9e2d56eca3922cc.png" alt="">

        <hr>

        <!-- Post Content -->
        <p class="lead">
          This room was probably one of my favourites of tryhackme. I recommend you
          finishing it on your own first!
        </p>

        <h3 id="recon">Reconnaissance</h3>
        <p>
          As usual I first started with a nmap and a nikto.
        </p>
        <pre>
          <code class="prettyprint">
            ![p4p1@computer notes/]$ nmap 10.10.117.246
            Starting Nmap 7.60 ( https://nmap.org ) at 2020-05-03 22:18 CEST
            Nmap scan report for 10.10.117.246
            Host is up (0.043s latency).
            Not shown: 998 closed ports
            PORT   STATE SERVICE
            22/tcp open  ssh
            80/tcp open  http

            Nmap done: 1 IP address (1 host up) scanned in 0.78 seconds

            ![p4p1@computer notes/]$ nikto -host 10.10.117.246
            - Nikto v2.1.5
            ---------------------------------------------------------------------------
            + Target IP:          10.10.117.246
            + Target Hostname:    10.10.117.246
            + Target Port:        80
            + Start Time:         2020-05-03 22:19:11 (GMT2)
            ---------------------------------------------------------------------------
            + Server: Apache/2.4.29 (Ubuntu)
            + The anti-clickjacking X-Frame-Options header is not present.
            + No CGI Directories found (use '-C all' to force check all possible dirs)
            + IP address found in the 'location' header. The IP is "127.0.1.1".
            + OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.1.1/images/".
            + DEBUG HTTP verb may show server debugging information. See http://msdn.microsoft.com/en-us/library/e8z01xdh%28VS.80%29.aspx for details.
            + Server leaks inodes via ETags, header found with file /icons/README, fields: 0x13f4 0x438c034968a80
            + OSVDB-3233: /icons/README: Apache default file found.
            + 6544 items checked: 15 error(s) and 6 item(s) reported on remote host
            + End Time:           2020-05-03 22:28:14 (GMT2) (543 seconds)
            ---------------------------------------------------------------------------
            + 1 host(s) tested
          </code>
        </pre>
        <p>
          The scans didn't return much information for me to use so I decided to move
          to OWASP ZAP:
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/zap.png" alt="">
        <p></p>
        <p>
          With that running and still not much information other than a /admin path
          I started inspecting the webpage.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/page.png" alt="">
        <p></p>
        <p>
          Seeing this page I started getting curious, How is the page converting it's
          videos. From the nmap and nikto scans I knew that the server was running
          Ubuntu so I was guessing command injection. Using BurpSuite I started
          debugging the form field:
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/burp.png" alt="">
        <p></p>
        <p>
          From that I figured out that replacing the url of the video with ;command;
          would allow me to execute a command so in python I created a
          <a href="https://gist.github.com/p4p1/e30f185ff5ba02fa7e427d1da3cd8547">simple shell</a>.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/code.png" alt="">
        <p></p>
        <p>
          The code highlighted in red is what I figured out last. The first time
          going through this box the server cut all of my commands after a space
          character and I was not able to execute commands with arguments so I had
          to replace the Space characters with tabs it was not easy at all to figure
          out and it took me 3hours, I felt so stupid.
        </p>

        <h3 id="exploit">Exploitation</h3>
        <p>
          With my script working I then figured out I had to get a fully working
          shell so I used python and pty to do so:
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/pty.png" alt="">
        <p></p>
        <p>
          After getting a shell I started looking around the file system and found
          a admin/ folder in witch there was a .htpasswd with an unknown hash and
          a username.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/admin.png" alt="">
        <p></p>
        <p>
          I ran the hash through hashcat on my machine to see if it could give me
          any solutions but it was a rabbit hole I never used that information again.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/hashcat.png" alt="">
        <p></p>

        <h3 id="privesc">Privilege Escalation</h3>
        <p>
          From that point I was stuck I look a lot around the file system on how I
          could get root access, I was out of luck. I ran linpeas.sh and linenum.sh
          but nothing stood out to me. Looking back now that I know the solution
          It probably was displayed on those scripts but I didn't look hard enough I
          guess.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/linpeas.png" alt="">
        <p></p>
        <p>
          After looking through more privilege escalation tutorials online I was
          burned out so I went to sleep. Waking up I decided to ask on discord to see
          if anyone could help me out. And ibarkay helped me! He told me to look into
          the cronjobs and to look at the tool pspy64s it could help me. I looked at
          the github page of pspy64s and installed it on the machine.
        </p>
        <img class="img-fluid rounded" src="img/convertmyvideo/pspy.png" alt="">
        <p></p>
        <p>
          Looking at the output I saw that there was a cronjob running a file located
          in /var/www/html/tmp:
        </p>
        <pre>
          <code class="prettyprint">
            /bin/sh -c cd /var/www/html/tmp && bash /var/www/html/tmp/clean.sh
          </code>
        </pre>

        <p>
          Using this information I then replaced the script so that it added a SUID
          bit to the bash program so that I could run bash with root privileges.
        </p>

        <hr />

        <p>
          Thank you for reading, check out my other write-ups and projects.
        </p>
        <hr />

        <h5 id="notes">Notes</h5>
        <p>
          Thanks to Ibarkay he helped me with the privilege escalation aspect and to
          Jomba Aeronaves Boing 157 who contacted me for some help on how to get the
          shell working and shared to me an other solution instead of replacing tabs
          in the script you can also replace with ${IFS}.
        </p>
        <pre>
          <code class="prettyprint">
            string=";%s;#" % cmd.replace(' ', '${IFS}')
          </code>
        </pre>

      </div>

      <!-- Sidebar Widgets Column -->
      <div class="col-md-4">

        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Categories</h5>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#recon">Reconnaissance</a>
                  </li>
                  <li>
                    <a href="#exploit">Exploitation</a>
                  </li>
                  <li>
                    <a href="#privesc">Privilege Escalation</a>
                  </li>
                  <li>
                    <a href="#notes">Notes</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Dark mode Widget -->
        <div class="card my-4">
          <h5 class="card-header">Dark Mode</h5>
          <div class="card-body">
            <label class="switch">
              <input type="checkbox" id="toggleshade" onclick="shade();shade2();">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="card my-4">
          <h5 class="card-header">My tryhackme account</h5>
          <div class="card-body">
            <script src="https://tryhackme.com/badge/17154"></script>
          </div>
        </div>
        <!-- Share widget -->
        <div class="card my-4">
          <h5 class="card-header">Share</h5>
          <div class="card-body">
            <!-- AddToAny BEGIN -->
            <div class="a2a_kit a2a_kit_size_32 a2a_default_style center">
              <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
              <a class="a2a_button_google_gmail"></a>
              <a class="a2a_button_facebook"></a>
              <a class="a2a_button_twitter"></a>
              <a class="a2a_button_reddit"></a>
            </div>
            <script async src="https://static.addtoany.com/menu/page.js"></script>
            <!-- AddToAny END -->
          </div>
        </div>
        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Links</h5>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="https://tryhackme.com/room/convertmyvideo">The challenge</a>
                  </li>
                  <li>
                    <a href="https://gist.github.com/p4p1/e30f185ff5ba02fa7e427d1da3cd8547">Command injection script</a>
                  </li>
                  <li>
                    <a href="https://unix.stackexchange.com/questions/351331/how-to-send-a-command-with-arguments-without-spaces">${IFS}</a>
                  </li>
              </div>
            </div>
          </div>
        </div>


      </div>

    </div>
    <!-- /.row -->

  </div>
  <!-- /.container -->

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <div class="row">

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Share</h4>
          <!-- AddToAny BEGIN -->
          <div class="a2a_kit a2a_kit_size_32 a2a_default_style center">
            <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
            <a class="a2a_button_google_gmail"></a>
            <a class="a2a_button_facebook"></a>
            <a class="a2a_button_twitter"></a>
            <a class="a2a_button_reddit"></a>
          </div>
          <script async src="https://static.addtoany.com/menu/page.js"></script>
          <!-- AddToAny END -->
        </div>

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">About this page</h4>
          <p class="lead mb-0">Template found <a target="_blank" rel="noopener noreferrer" href="https://startbootstrap.com/themes/freelancer/">here</a>.</p>
        </div>

        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Follow me</h4>
          <a class="btn btn-outline-light btn-social mx-1" href="https://www.linkedin.com/in/leo-smith/">
            <i class="fab fa-fw fa-linkedin-in"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://github.com/p4p1">
            <i class="fab fa-github"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://linuxsecurity.expert/p/leo-smith">
              <i class="fab fa-linux"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://tryhackme.com/p/p4p1">
              <i class="fas fa-flag-checkered"></i>
          </a>
        </div>

      </div>
    </div>
  </footer>
  <!-- Copyright Section-->
  <section class="copyright py-4 text-center text-white">
    <div class="container"><small>Copyright © Leo Smith 2020</small></div>
  </section>
  <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
  <div class="scroll-to-top d-lg-none position-fixed ">
    <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
      <i class="fa fa-chevron-up"></i>
    </a>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="../vendor/jquery/jquery.min.js"></script>
  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Contact Form JavaScript -->
  <script src="../js/jqBootstrapValidation.js"></script>
  <script src="../js/contact_me.js"></script>

  <!-- Custom scripts for this template -->
  <script src="../js/freelancer.min.js"></script>
  <script src="../js/hidden.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163484307-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-163484307-1');
  </script>

  <script>
    var card = document.getElementsByClassName("card");
    var h4Elements = document.getElementsByTagName("h4");
    var dark2=getDarkcookie();
    document.addEventListener('keypress', logKey2);
    if (dark2 == 1) {
      for (var i = 0; i < card.length; i++) {
        card[i].style.backgroundColor = "#423d3d";
      }
    }
    function logKey2(e) {
      if (e.key === 'b') {
        if (dark2 == 0) {
          document.getElementById("toggleshade").checked = true;
          document.cookie = "dark=1";
          for (var i = 0; i < card.length; i++) {
            card[i].style.backgroundColor = "#423d3d";
          }
          for(var i = 0; i < h4Elements.length; i++) {
               h4Elements[i].style.color = "#fff";
          }
          dark2 = 1;
        } else {
          document.getElementById("toggleshade").checked = false;
          document.cookie = "dark=0";
          document.body.style.color = "#000"
          for (var i = 0; i < card.length; i++) {
            card[i].style.backgroundColor = "#FFF";
          }
          for(var i = 0; i < h4Elements.length; i++) {
               h4Elements[i].style.color = "#fff";
          }
          dark2 = 0;
        }
      }
    }
    function shade2() {
      if (dark2 == 0) {
        document.getElementById("toggleshade").checked = true;
        document.cookie = "dark=1";
        for (var i = 0; i < card.length; i++) {
          card[i].style.backgroundColor = "#423d3d";
        }
        for(var i = 0; i < h4Elements.length; i++) {
             h4Elements[i].style.color = "#fff";
        }
        dark2 = 1;
      } else {
        document.getElementById("toggleshade").checked = false;
        document.cookie = "dark=0";
        document.body.style.color = "#000"
        for (var i = 0; i < card.length; i++) {
          card[i].style.backgroundColor = "#FFF";
        }
        for(var i = 0; i < h4Elements.length; i++) {
             h4Elements[i].style.color = "#fff";
        }
        dark2 = 0;
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

</body>

</html>
